---
###########   Create CVO Instace in AWS  #############
- name: Create NetApp Cloud Manager CVO for AWS single
  netapp.cloudmanager.na_cloudmanager_cvo_aws:
    state: present
    refresh_token: "{{ token }}"
    name: "{{ cvo_name }}"
    region: "{{ region_deploy }}"
    subnet_id: "{{ subnet }}"
    vpc_id: "{{ vpc }}"
    svm_password: "{{ cvo_svm_password }}"
    client_id: "{{ connector.msg.client_id }}"
    writing_speed_state: NORMAL
    is_ha: false
    associate_public_ip_address: false
  tags:
    - aws_cvo_single

################# Create HA Instance #########################

- name: Create NetApp Cloud Manager CVO for AWS HA
  netapp.cloudmanager.na_cloudmanager_cvo_aws:
    state: present
    refresh_token: "{{ token }}"
    name: "{{ cvo_name }}"
    region: "{{ region_deploy }}"
    subnet_id: "{{ subnet }}"
    vpc_id: "{{ vpc }}"
    svm_password: "{{ cvo_svm_password }}"
    client_id: "{{ connector.msg.client_id }}"
    writing_speed_state: NORMAL
    aws_tag: [
        {tag_key: abc,
        tag_value: a123}]
    is_ha: true
    mediator_assign_public_ip: false
    node1_subnet_id: "{{ subnet }}"
    node2_subnet_id: "{{ subnet }}"
    mediator_subnet_id: "{{ subnet }}"
  tags:
    - aws_cvo_ha
