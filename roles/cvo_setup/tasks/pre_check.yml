---
##### Install Boto3 and awscli #####
- name: Install the pre-reqs for connector
  become: yes
  pip:
    name:
       - boto3
       - chardet
       - urllib3
       - requests
       - awscli
       - pexpect
  tags:
    - pre_check

##### Running Credentials ########
- name: Run aws configure
  expect:
    command: aws configure
    responses:
      AWS Access Key ID:  "{{ access_key }}"                                                                                    
      AWS Secret Access Key: "{{ secret_key }}"                                                                                
      Default region name: "us-east-1"
      Default output format: ""
  no_log: false

  tags:
    - pre_check

########## Create Role ########
- name: Create Role
  iam_role:
    name: occm_sufian2
    assume_role_policy_document: "{{ lookup('file','policy.json') }}"
    state: present
    validate_certs: true
    aws_access_key: "{{ access_key }}"
    aws_secret_key: "{{ secret_key }}"
  tags:
    - pre_check


