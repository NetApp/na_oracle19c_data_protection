- block:

######## Create Access Token with username/password #############
    - name: Create access token with username/password
      uri:
        url: "https://netapp-cloud-account.auth0.com/oauth/token"
        method: POST
        body_format: json
        body:
          grant_type: password
          username: "{{ email_id }}"
          password: "{{ password }}"
          audience: "https://api.cloud.netapp.com"
          scope: profile
          client_id: "{{ regular_id }}"
        headers:
          Content-Type: application/json
      register: connector_accesstoken
      when: connector_access == "password"
    - debug: var=connector_accesstoke
      
######## Create Access Token with Refresh Token #############      
    - name: Create access token with refresh token
      uri:
        url: "https://netapp-cloud-account.auth0.com/oauth/token"
        method: POST
        body_format: json
        body:
          grant_type: refresh_token
          refresh_token: "{{ token }}"
          client_id: "{{ sso_id }}"
        headers:
          Content-Type: application/json
      register: connector_accesstoken
      when: connector_access == "refresh_token"
    - debug: var=connector_accesstoken
    
################## Get Workspace ID ###################
    - name: Get Workspace ID
      uri:
        url: "https://cloudmanager.cloud.netapp.com/tenancy/account/{{ account }}/workspace"
        method: GET
        return_content: yes
        headers:
          Content-Type: application/json
          Authorization: "Bearer {{ connector_accesstoken.json.access_token }}"
      register: result
    - set_fact:
        msgs: "{{ result | json_query('json[0]') }}"
    - debug: var=msgs.workspacePublicId
  rescue:
    - name: Failure 
      fail:
        msg: 
        - Add on-prem ONTAP cluster to connector in Cloud Manager failed!
        - Possible troubleshooting steps:
        - 1. Check if connector API endpoint is reachable 
        - 2. Check if provided workspace_id and on-prem ONTAP cluster details are correct
        - 3. Check if variables defined adhere to the guidelines
